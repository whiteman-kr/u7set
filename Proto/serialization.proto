package Proto;

//------------------------------------------------------------------------------------------
//
//
//								Global structs
//
//
//------------------------------------------------------------------------------------------

//
//
// QUuid
//
//
message Uuid
{
	required bytes uuid = 1;
}

//
//
// QVariant
//
//
message qvariant
{
	required int32 type = 1;
	optional int32 intValue = 2 [default = 0];
	optional uint32 uintValue = 3 [default = 0];
	optional double doubleValue = 4 [default = 0];
	optional bool boolValue = 5 [default = false];
}


//
//
// Unicode строка
//
//
//
message wstring
{
	required bytes text = 1;
}


//
//
// FontParam
//
//
message FontParam
{
	required wstring name = 1;
	required double size = 2;
	required bool bold = 3;
	required bool italic = 4;
}

//
//
// SchemePoint
//
//
message SchemePoint
{
	required double x = 1;
	required double y = 2;
}

//
//
// SchemeUnit
//
//
enum SchemeUnit
{
	Display = 0;			// измерение в точках устройства (пиксели для дисплея)
	Millimeter = 1;			// измерение в мм
	Inch = 2;				// измерение в дюймах
}


//
//
// ConnectionDirrection
//
//
enum ConnectionDirrection
{
	Input = 0;
	Output = 1;
}


//------------------------------------------------------------------------------------------
//
//
//		Envelope - General struct, keeps any base type
//
//
//------------------------------------------------------------------------------------------
message Envelope
{
	// C++ Class for serizalization
	//
	required uint32 classnamehash = 1;				// Hash from classname, the way of getting the hash is always same

	// Possible types for storing
	//
	optional SchemeItem schemeitem = 6;				// VFrame30::SchemeItem
	optional DeviceObject deviceobject = 7;			// Hardware::DeviceObject
	optional Scheme scheme = 100;					// VFrame30::Scheme
	optional VideoLayer videolayer = 101;			// VFrame30::CVideoLayer
	optional FblElement fblelement = 102;			// Fbl::FblElement
	optional Configuration configuration = 103;		// VFrame30::Configuration
}


//------------------------------------------------------------------------------------------
//
//
//			VFrame30::Configuration
//
//
//------------------------------------------------------------------------------------------
message Configuration
{
	required Uuid uuid = 1;
	required wstring strID = 2;
	required wstring caption = 3;
	required wstring variables = 4;
	required wstring globals = 5; 
	
	repeated Uuid schemesIDs = 100;
	repeated Envelope schemes = 101;
}


//------------------------------------------------------------------------------------------
//
//
//								Afbl namespace
//
//
//------------------------------------------------------------------------------------------


//
//
// Afbl::AfbElementCollection stored as XML
//
//
message AfbElementCollection
{
	repeated AfbElementXml elements = 1;
}


//
//
// Afbl::AfbElement stored as XML
//
//
message AfbElementXml
{
	required bytes data = 1;
}


//
//
// Afbl::FblElement stored as Protobuf
//
//
message FblElement
{
	required wstring strID = 2;
	required wstring caption = 3;
	required uint32 opcode = 4;
	optional bool hasRam = 5 [default = false];
	optional bool requiredStart = 6 [default = true];

	repeated FblElementSignal inputSignals = 11;
	repeated FblElementSignal outputSignals = 12;
	repeated FblElementParam params = 13;

	optional wstring description = 14;
}


//
//
// Afbl::FblElementSignal
//
//
message FblElementSignal
{
	required wstring caption = 1;
	required FblSignalType type = 2;
	optional int32 operandIndex = 3 [default = 0];
	optional int32 size = 4 [default = 0];
	optional wstring opName = 5;
}


//
//
// Afbl::FblElementParam
//
//
message FblElementParam
{
	required wstring caption = 1;
	required FblParamType type = 2;
	required bool visible = 7;
	optional int32 operandIndex = 8 [default = 0];
	optional int32 size = 9 [default = 0];
	optional bool instantiator = 10 [default = false];
	optional bool user = 11 [default = false];
	optional wstring changedScript = 12;
	optional qvariant value = 13;
	optional qvariant defaultvalue = 14;
	optional qvariant lowlimit = 15;
	optional qvariant highlimit = 16;
	optional wstring opName = 17;
}



//
//
// FblSignalType
//
//
enum FblSignalType
{
	Analog = 0;
	Discrete = 1;
}

//
//
// FblParamType
//
//
enum FblParamType
{
	AnalogIntegral = 0;			// 32bit signed int
	AnalogFloatingPoint = 1;	// double, 64bit
	DiscreteValue = 2;			// bool, c++
}


//------------------------------------------------------------------------------------------
//
//
//			VFrame30::Scheme
//
//
//------------------------------------------------------------------------------------------
message Scheme
{
	required Uuid uuid = 1;
	required wstring strID = 2;
	required wstring caption = 3;
	required double width = 4;
	required double height = 5;
	required SchemeUnit unit = 6;
	optional bool excludeFromBuild = 7 [default = false];

	repeated Envelope layers = 100;				// Layer list
	required AfbElementCollection afbs = 101;	// Application Fuynctional Block stored as XML

	// Derived from Scheme
	//
	optional LogicScheme logics_scheme = 200;
}


//
//
// LogicScheme
//
//
message LogicScheme
{
	repeated wstring hardware_strids = 1;
}


//------------------------------------------------------------------------------------------
//
//
//			VFrame30::VideoLayer
//
//
//------------------------------------------------------------------------------------------
message VideoLayer
{
	required Uuid uuid = 1;
	required wstring name = 2;
	required bool compile = 3;
	required bool show = 4;
	required bool print = 5;

	repeated Envelope items = 15;		// Список SchmeItem'ов
}


//------------------------------------------------------------------------------------------
//
//
//			VFrame30::SchemeItem
//
//
//------------------------------------------------------------------------------------------
message SchemeItem
{
	required Uuid uuid = 1;
	required bool isStatic = 2;
	required bool isLocked = 3;
	required SchemeUnit itemUnit = 4;
	optional bool acceptClick = 5 [default = false];
	optional wstring clickScript = 6;

	// Наследуемые от SchmeItem
	//
	optional PosRectImpl PosRectImpl = 10;
	optional PosLineImpl PosLineImpl = 11;
	optional PosConnectionImpl PosConnectionImpl = 12;

	// --
	//
	optional FblItem FblItem = 106;								//
	optional FblItemRect FblItemRect = 107;						// +PosRectImpl, FblItem
	optional FblItemLine FblItemLine = 108;						// +PosConnectionImpl, FblItem
	
	// Наслдедуемые от PosRectImpl, PosLineImpl, PosConnectionImpl
	//
	optional SchemeItemRect Rect = 116;							// +PosRectImpl
	optional SchemeItemLine Line = 117;							// +PosLineImpl
	optional VideoItemConnectionLine ConnectionLine = 118;		// +PosConnectionImpl
	
	optional VideoItemSignal Signal = 124;						// +FblItemRect
	optional VideoItemInputSignal InputSignal = 125;			// +Signal
	optional VideoItemOutputSignal OutputSignal = 126;			// +Signal
	optional VideoItemLink Link = 127;							// +FblItemLine
	optional VideoItemFblElement VideoItemFblElement = 128;		// +FblItemRect
	optional SchemeItemConst ConstItem = 129;					// +FblItemRect
}


//
//
// PosRectImpl
//
//
message PosRectImpl
{
	required double leftDocPt = 1;
	required double topDocPt = 2;
	required double widthDocPt = 3;
	required double heightDocPt = 4;
}


//
//
// PosLineImpl
//
//
message PosLineImpl
{
	required double startXDocPt = 1;
	required double startYDocPt = 2;
	required double endXDocPt = 3;
	required double endYDocPt = 4;
}


//
//
// PosConnectionImpl
//
//
message PosConnectionImpl
{
	repeated SchemePoint points = 1;
}


//
//
// SchemeItemRect
//
//
message SchemeItemRect
{
	required double weight = 1;
	required uint32 lineColor = 2;
	required uint32 fillColor = 3;
	required wstring text = 4;
	required uint32 textColor = 5;
	required FontParam font = 6;
	required bool fill = 7;
	optional bool drawrect = 8 [default = true];
}

//
//
// SchemeItemLine
//
//
message SchemeItemLine
{
	required double weight = 1;
	required uint32 lineColor = 2;
}

//
//
// VideoItemConnectionLine
//
//
message VideoItemConnectionLine
{
	required double weight = 1;
	required uint32 lineColor = 2;
}


//
//
// FblConnectionPoint
//
//
message FblConnectionPoint
{
	optional SchemePoint point = 1;					// Can be removed in future, not used anymore
	optional ConnectionDirrection dirrection = 2;
	optional Uuid uuid = 3;
	optional int32 operandIndex = 4 [default = -1];		// -1 is not used, for links etc...
	optional string caption = 5 [default = ""];
	
	//optional Uuid signalUuid = 10;
	//optional wstring signalStrID = 11;
}


//
//
// FblItem
//
//
message FblItem
{
	repeated FblConnectionPoint points = 1;
}


//
//
// FblItemRect
//
//
message FblItemRect
{
	required double weight = 1;
	required uint32 lineColor = 2;
	required uint32 fillColor = 3;
	required uint32 textColor = 4;
	required FontParam font = 5;
}


//
//
// FblItemLine
//
//
message FblItemLine
{
	required double weight = 1;
	required uint32 lineColor = 2;
}


//
//
// VideoItemSignal
//
//
message VideoItemSignal
{
	repeated wstring signalStrIDs = 1;
}


//
//
// VideoItemInputSignal
//
//
message VideoItemInputSignal
{
}


//
//
// VideoItemOutputSignal
//
//
message VideoItemOutputSignal
{
}


//
//
// VideoItemLink
//
//
message VideoItemLink
{
}


//
//
// VideoItemFblElement
//
//
message VideoItemFblElement
{
	repeated FblElementParam params = 2;
	optional wstring afbStrid = 3;
}

//
//
// SchemeItemConst
//
//
message SchemeItemConst
{
	optional int32 type = 1 [default = 0];
	optional int32 intValue = 2 [default = 0];
	optional double floatValue = 3 [default = 0.0];
}

//------------------------------------------------------------------------------------------
//
//
//								Hardware::DeviceObject
//
//
//------------------------------------------------------------------------------------------

message DeviceObject
{
	required Uuid uuid = 1;
	required wstring strId = 2;
	required wstring caption = 3;
	optional wstring childRestriction = 4;
	optional int32 place = 5 [default = 0];
	optional string dynamic_properties_struct = 6;
	repeated Property properties = 7;

	optional bool preset = 32 [default = false];
	optional bool presetRoot = 33 [default = false];
	optional wstring presetName = 34;

	// Derived from Hardware::DeviceObject
	//
	optional DeviceRoot Root = 100;					// Not used
	optional DeviceSystem System = 101;
	optional DeviceRack Rack = 102;
	optional DeviceChassis Chassis = 103;
	optional DeviceModule Module = 104;
	optional DeviceController Controller = 105;
	optional DeviceSignal Signal = 106;
	optional Workstation Workstation = 107;
	optional Software Software = 108;

}

message DeviceRoot
{
}

message DeviceSystem
{
}

message DeviceRack
{
}

message DeviceChassis
{
	optional int32 type = 1 [default = 0];
}

message DeviceModule
{
	optional int32 type = 1 [default = 0];

    optional int32 Channel = 2 [default = 0];
	optional string SubsysID = 3 [default = ""];
	optional string ConfType = 4 [default = ""];
}

message DeviceController
{
}

message DeviceSignal
{
		optional int32 obsoletetype = 1 [default = 0];			// old type format, not used anymore, RPCT-345

        optional int32 byteOrder = 2 [default = 0];
        optional int32 format = 3 [default = 0];
        optional int32 size = 4 [default = 0];
        optional int32 validityOffset = 5 [default = 0];
        optional int32 validityBit = 6 [default = 0];
        optional int32 valueOffset = 7 [default = 0];
		optional int32 valueBit = 8 [default = 0];
		optional int32 type = 9 [default = 0];					// RPCT-345
		optional int32 function = 10 [default = 0];				// RPCT-345
}

message Workstation
{
        optional int32 type = 1 [default = 0];
}

message Software
{
        optional int32 type = 1 [default = 0];
}


// Module Configuration
//
message ModuleConfiguration
{
	optional string struct_description = 1;				// XML description of the mudule configuration structure
	repeated ModuleConfigurationValue values = 2;		// Values array
    optional string name = 3 [default = ""];            // Configuration Name
}

message ModuleConfigurationValue
{
	required string name = 1;
	required string value = 2;
}

message Property
{
	required string name = 1;
	required string value = 2;
}

//------------------------------------------------------------------------------------------
//
//
//			??????
//
//
//------------------------------------------------------------------------------------------
